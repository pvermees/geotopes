---
title: "Additional exercises"
output:
  pdf_document:
    includes:
      keep_tex: yes
    number_sections: yes
---

```{r settings, include = FALSE}
solution <- FALSE
knitr::opts_chunk$set(echo=solution, include=FALSE)
set.seed(1)
# rmarkdown::render('~/Documents/geotopes/latex/extra.Rmd')
```

\newif\ifsol
\sol`r ifelse(solution, 'true', 'false')`

# Theory

1. A mass spectrometer has a radius of 0.3 m and an acceleration
voltage of 10 000 V. The magnetic field is adjusted to the various
masses to be measured. Calculate the atomic mass of a single charged
ion corresponding to a field of 0.5 T. Note: the elementary charge is
$1.60219\times{10}^{-19}$ C and 1 atomic mass unit (amu) =
$1.660538\times{10}^{-27}$ kg.

   \ifsol
   Rearrange Equation 3.4 of the notes:
   \[
   m = \frac{e(rH)^2}{2V}
   \]
   \fi

   ```{r}
   e <- 1.60219e-19 # C
   r <- 0.3 # m
   H <- 0.5 # T
   V <- 1e4 # V
   M <- 1.660538e-27 # kg/nucleon
   m <- (e*(r*H)^2)/(2*V)
   m/M
   ```

1. What types of radioactivity are involved in the following
reactions: ${}^{146}_{~62}$Sm $\rightarrow$ ${}^{142}_{60}$Nd,
${}^{53}_{25}$Mn $\rightarrow$ ${}^{53}_{24}$Cr, ${}^{230}_{~90}$Th
$\rightarrow$ ${}^{226}_{88}$Ra?

   \ifsol
   ${}^{146}_{~62}$Sm $\rightarrow$ ${}^{142}_{60}$Nd: $\alpha$
   
   ${}^{53}_{25}$Mn $\rightarrow$ ${}^{53}_{24}$Cr: e.c.
   
   ${}^{230}_{~90}$Th $\rightarrow$ ${}^{226}_{88}$Ra: $\alpha$
   \fi

1. Rb has two isotopes, ^85^Rb and ^87^Rb, which exist in a constant
ratio in our Solar System: ^85^Rb/^87^Rb = 2.5933. The molar mass of
Rb is 85.4678. A rock contains 10ppm of Rb. How many mol/g of ^87^Rb
does that correspond to?

   \ifsol
   Compute the abundance of ^87^Rb:
   \[
   f87 + f85 = 1
   \Rightarrow
   1 + \frac{f85}{f87} = \frac{1}{f87}
   \Rightarrow
   f87 = \frac{1}{1 + \frac{f85}{f87}}
   \]
   \fi

   ```{r}
   r57 <- 2.5933
   f87 <- 1/(1+r57) # mol/mol
   ppmRb <- 10     # ug/g
   MRb <- 85.4678   # ug/umol
   umolgRb87 <- f87*ppmRb/MRb
   message(signif(umolgRb87,5),' micromol/g 87Rb')
   ```

1. Following up from the previous question: ^87^Rb is radioactive with
a half-life $t_{1/2}=48.8$ Gyr. What was the ^85^Rb/^87^Rb-ratio 2
billion years ago?

   \ifsol
   Compute initial ^87^Rb from present amount:
   \[
   P_\circ = P\exp[\lambda{t}]
   \]
   \fi

   ```{r}
   # 1. compute the decay constant:
   t12 = 48.8
   l87 = log(2)/t12
   # 2. restore 87Rb to 2 Ga:
   f85 <- 1-f87
   umolgRb <- ppmRb/MRb
   umolgRb85 <- f85*umolgRb
   umolgRb87 <- f87*umolgRb
   age <- 2
   umolgRb85_o <- umolgRb85
   umolgRb87_o <- umolgRb87*exp(l87*age)
   r57_o <- umolgRb85_o/umolgRb87_o
   message('87Rb/85Rb ratio at 2 Ga: ',signif(r57_o,5))
   ```

1. The half-life of ^14^C is 5730 years. The ^14^C content of the
atmosphere is 13.2 disintegrations per minute and per gram (dpm
g${}^{-1}$) of carbon (initial activity $A_0$). We wish to date an
Egyptian artefact from approximately 2000 BC. What is the approximate
activity (A) of this artefact? If our method can measure 1 dpm, what
mass of the (probably precious) sample will have to be destroyed?

   ```{r}
   # decay constant:
   t12 <- 5730
   l14 <- log(2)/t12
   BC <- 2000
   now <- 2022
   age <- now + BC
   A0 <- 13.2
   A <- A0*exp(-l14*age) # dpm/g
   mass <- 1000/A
   message('The expected activity ratio is ',signif(A,2),
   ', which requires ',signif(mass,2),' mg of material.')
   ```

1. ^210^Pb is a short lived (t~1/2~=22.3 yr) intermediate daughter of
the ^238^U decay chain. This natural radioactive lead is incorporated
into ice deposited in Greenland by forming successive layers of ice
which can be studied like sedimentary strata.  The activity of ^210^Pb
is measured at four levels in disintegrations per hour per kilogram of
ice.
   ```{r include=FALSE}
   depth <- c(0,1,1.5,2.5)
   l210 <- log(2)/22.3 # yr-1
   Pb210i <- 75
   rate <- 4e-2 # m/yr
   Pb210 <- Pb210i*exp(-l210*depth/rate)
   tabPb210 <- rbind(depth,signif(Pb210,3))
   rownames(tabPb210) <- c("depth (m)","^210^Pb (dph/kg)")
   colnames(tabPb210) <- 1:length(depth)
   ```
   ```{r include=TRUE, echo=FALSE, results='asis'}
   knitr::kable(tabPb210)
   ```
   
   Calculate the sedimentation rate of the ice. Assuming a constant
   rate and a compaction factor of 5, how much ice will have
   accumulated in 5000 years?  Calculate the ^210^Pb-content of fresh
   ice (in mol/kg or atoms/kg).

   \ifsol
   \[
   {}^{210}Pb = {}^{210}Pb_\circ \exp[-\lambda_{210}t]
   \]
   If the rate of deposition is $r$ and depth $d$, we have $t = d/r$.
   The equation then becomes:
   \[
   {}^{210}Pb = {}^{210}Pb_\circ \exp[-\lambda_{210}d/r]
   \]
   Taking logarithms:
   \[
   \ln[{}^{210}Pb] = \ln[{}^{210}Pb_\circ] -\lambda_{210}d/r
   \]
   If the initial \textsuperscript{210}Pb content has remained constant over time,
   the data points must be aligned in a plot of $\ln[{}^{210}Pb]$ vs. $d$.
   The slope is therefore $-\lambda_{210}$/r.
   A modern activity of $\lambda_{210}N_{210} = 75$ dph/kg corresponds to
   $(75\times{24}\times{365.25})/\lambda_{210}$ atoms of ${}^{210}$Pb. This turns
   out to be a mere 21 million atoms per kg!
   \fi
   ```{r fig.width=4, fig.height=4}
   depth <- tabPb210[1,]
   Pb210 <- tabPb210[2,]
   fit <- lm(log(Pb210) ~ depth)
   l210 <- log(2)/22.3
   r <- -l210/fit$coefficients[2]
   message("The accumulation rate is ",signif(100*r,3),'cm/yr')
   message("In 5000 years, there will be ",signif(5000*r/5,3),'m of ice accumulation')
   Pb210atoms <- Pb210[1]*24*365.25/l210 
   message("1 kg of modern ice contains ", round(Pb210atoms/1e6),' million atoms of 210Pb')
   plot(depth,Pb210,type='p',log='y')
   lines(depth,exp(fit$fitted.values))
   ```

1. Consider the Rb-Sr composition of three aliquots from the same
sample:
   ```{r include=FALSE}
   t12Rb87 <- 48.8
   l87 <- log(2)/t12Rb87
   tRbSr <- 1.5
   Rb87Sr86 <- c(0.05,0.1,0.2)
   Sr87Sr86_0 <- 0.7
   Sr87Sr86 <- Sr87Sr86_0 + Rb87Sr86*(exp(l87*tRbSr)-1)
   tabRbSr <- cbind(Rb87Sr86,signif(Sr87Sr86,5))
   colnames(tabRbSr) <- c("^87^Rb/^86^Sr","^87^Rb/^86^Rb")
   rownames(tabRbSr) <- c("mineral A","mineral B","mineral C")
   ```
   ```{r include=TRUE, echo=FALSE, results='asis'}
   knitr::kable(tabRbSr)
   ```
   How old is the sample?

   ```{r fig.width=4, fig.height=4}
   RbSr <- tabRbSr[,1]
   SrSr <- tabRbSr[,2]
   plot(x=RbSr,y=SrSr,type='b')
   fit <- lm(SrSr ~ RbSr)
   tRbSr <- log(fit$coefficients[2]+1)/l87
   message('Rb/Sr-age = ',signif(tRbSr*1000,2),' Ma')
   ```

1. What is the expected ^207^Pb/^206^Pb-ratio of a 4.57 billion year
old meteorite? Assume that the meteorite contained no initial Pb.  The
half-lives of ^238^U and ^235^U are 4.468 and 0.704 Gyr, respectively.
The present-day ^238^U/^235^U-ratio is 137.818. What is the expected
^207^Pb/^206^Pb-ratio for modern uranium-ores?

   ```{r}
   # meteorite:
   tPbPb <- 4.57
   l38 <- log(2)/4.468
   l35 <- log(2)/0.704
   r58 <- 1/137.818
   rPbPb_meteorite <- r58*(exp(l35*tPbPb)-1)/(exp(l38*tPbPb)-1)
   message('Expected 207Pb/206Pb-ratio for a 4.57 Ga meteorite = ',
   	    signif(rPbPb_meteorite,3))
   ```
   \ifsol
   For modern U-ores, assuming secular equilibrium:
   \[
   \frac{{}^{207}Pb}{{}^{206}Pb} =
   \frac{\partial{N_{207}}/\partial{t}}{\partial{N_{206}}/\partial{t}}
   \]
   with
   \[
   \partial{N_{206}}/\partial{t} = \lambda_{238}N_{238},
   \partial{N_{207}}/\partial{t} = \lambda_{235}N_{235}
   \]
   and
   \[
   N_{238}/N_{235} = 137.818
   \]
   $\Rightarrow$
   \[
   \frac{N_{207}}{N_{206}} = \frac{\lambda_{235}N_{235}}{\lambda_{238}N_{238}}
   \]
   \fi
   ```{r}
   message('expected 207Pb/206Pb ratio of modern U-ores = ',signif(r58*l38/l35,3))
   ```

1. Consider the following three aliquots from the same sample:
   ```{r include=FALSE}
   l38 <- log(2)/4468
   l35 <- log(2)/704
   t1 <- 2000
   t2 <- 1000
   U8Pb4 <- c(0,100,180,200)
   U85 <- 137.818
   U5Pb4 <- U8Pb4/U85
   floss <- c(0,0,0.5,1)
   Pb64i <- 9
   Pb74i <- 10
   Pb64_1 <- U8Pb4*(exp(l38*t1)-1)
   Pb74_1 <- U5Pb4*(exp(l35*t1)-1)
   Pb64_2 <- U8Pb4*(exp(l38*t2)-1)
   Pb74_2 <- U5Pb4*(exp(l35*t2)-1)
   Pb64 <- Pb64i + (1-floss)*Pb64_1 + floss*Pb64_2
   Pb74 <- Pb74i + (1-floss)*Pb74_1 + floss*Pb74_2
   tabUPb <- signif(cbind(Pb64,Pb74,U8Pb4),4)
   rownames(tabUPb) <- c('aliquot A','aliquot B','aliquot C','aliquot D')
   colnames(tabUPb) <- c("^206^Pb/^204^Pb","^207^Pb/^204^Pb","^238^U/^204^Pb")
   ```
   ```{r include=TRUE, echo=FALSE, results='asis'}
   knitr::kable(tabUPb)
   ```
   a. Calculate the ^206^Pb/^238^U and ^207^Pb/^235^U ages

   b. Sketch a geological history for the sample (hint: consider the
   U-Pb composition in concordia space).
   
   ```{r fig.width=4, fig.height=4}
   # common Pb composition:
   Pb64i <- tabUPb[1,1]
   Pb74i <- tabUPb[1,2]
   Pb6U8 <- (tabUPb[-1,1]-Pb64i)/tabUPb[-1,3]
   Pb7U8 <- (tabUPb[-1,2]-Pb74i)/tabUPb[-1,3]
   Pb85 <- 137.818
   Pb7U5 <- Pb7U8*Pb85
   tPb6U8 <- log(Pb6U8+1)/l38
   tPb7U5 <- log(Pb7U5+1)/l35
   ttab <- signif(cbind(tPb6U8,tPb7U5),3)
   colnames(ttab) <- c('t(206Pb/238U)','t(207Pb/235U)')
   print(rbind(ttab))
   colnames(tabUPb) <- c('206Pb/204Pb','207Pb/204Pb','238U/204Pb')
   IsoplotR::concordia(tlim=c(0,2500))
   points(Pb7U5,Pb6U8,pch=16)
   lines(Pb7U5,Pb6U8)
   text(Pb7U5,Pb6U8,labels=c('B','C','D'),pos=1)
   ```
   
   \ifsol Aliquot A does not contain uranium, and therefore
   constrains the common Pb composition of the sample. Aliquots B and
   D yielded concordant U-Pb ages and constrain two geological
   events. Aliquot B gives the crystallisation age. Aliquot D is
   younger and dates a resetting event.  Aliquot C has experienced
   partial Pb-loss. It falls halfway between B and D on the mixing
   line defined by these two points.  Hence the geological history is
   as follows:

   \begin{enumerate}
   \item Crystallisation at 2000 Ma
   \item A metamorphic event at 1000 Ma resulting in partial Pb-loss
   \item Subsequent tectonic quiescence
   \end{enumerate}
   \fi

1. Consider the Pb-Pb composition of three aliquots from a meteorite:
   ```{r include=FALSE}
   l35 <- IsoplotR::settings('lambda','U235')[1]
   l38 <- IsoplotR::settings('lambda','U238')[1]
   tPbPb <- 4550
   Pb64_i <- 4/0.6
   Pb74_i <- 4
   Pb64_r <- c(100,400,1000)
   U85 <- 137.818
   Pb74_r <- Pb64_r*(exp(l35*tPbPb)-1)/(exp(l38*tPbPb)-1)/U85
   Pb64 <- Pb64_i + Pb64_r
   Pb74 <- Pb74_i + Pb74_r
   PbPbtab <- signif(rbind(Pb64,Pb74),3)
   rownames(PbPbtab) <- c("^206^Pb/^204^Pb","^207^Pb/^204^Pb")
   colnames(PbPbtab) <- 1:3
   ```
   ```{r include=TRUE, echo=FALSE, results='asis'}
   knitr::kable(PbPbtab)
   ```
   Use the following lookup table to estimate the age of the meteorite:
   ```{r include=TRUE, echo=FALSE, results='asis'}
   tgrid <- seq(from=tPbPb-100,to=tPbPb+100,by=25)
   Pb76ratios <- IsoplotR::age2ratio(tgrid,ratio="Pb207Pb206")[,1]
   ttab <- rbind(format(tgrid,digits=1),signif(Pb76ratios,3))
   rownames(ttab) <- c("age (Ma)","^207^Pb/^206^Pb")
   knitr::kable(ttab)
   ```

   Hint: plot ^207^Pb/^204^Pb vs. ^206^Pb/^204^Pb.
   ```{r out.width='60%', fig.width=5, fig.height=4}
   Pb64 <- PbPbtab[1,]
   Pb74 <- PbPbtab[2,]
   Pb76 <- lm(Pb74 ~ Pb64)$coefficients[2]
   result <- IsoplotR::age(Pb76,method="Pb207-Pb206")[1]
   message("The age of the meteorite is ",signif(result,3),' Ma.')
   plot(x=Pb64,y=Pb74,type='b',
	 xlab=expression(""^206*"Pb/"^204*"Pb"),
	 ylab=expression(""^207*"Pb/"^204*"Pb")
   )
   ```

1. The silicate Earth weighs approximately $4\times{10}^{24}$ kg and
contains 250 ppm potassium. How much ^40^Ar is created in 4.5 billion
years?  Given that ^40^Ar cannot escape from the Earth and the
quantity of ^40^Ar in the atmosphere is 66000 Gt, what is the ``K-Ar
age of the Earth's atmosphere''?  K has three isotopes with
^39^K/^40^K = 7771 and ^41^K/^40^K = 561. ^40^K is radioactive and
undergoes branched decay to ^40^Ar (10.72%) and ^40^Ca (89.28%) with a
half-life of 1.248 billion years. The molar mass of K is 39.1 g/mol.

   ```{r}
   GtEarth <- 4e24/1e12  # convert kg to Gt
   GtK <- GtEarth*250e-6 # Gt of K in the silicate Earth
   MK <- 39.1e-6 # Gt/Gmol
   GmolK <- GtK/MK # Gmol
   f40K <- 1/(7771 + 561 + 1) # 40K/K
   GmolK40 <- GmolK*f40K # Gmol of 40K in the silicate Earth
   GtAr40 <- 66e3
   M40K <- 40e-6 # Gt/Gmol
   GmolAr40 <- GtAr40/M40K
   Ar40K40 <- GmolAr40/GmolK40
   l40 <- log(2)/1.248
   fec <- 0.1072 # fraction of 40K decaying to 40Ar
   atmage <- log(Ar40K40/fec+1)/l40
   message("The 40Ar/40K-age of the Earth's atmosphere is ",
          signif(atmage,3),' Ga.')
   ```
   
1. ^129^I is an extinct nuclide of Iodine with a half-life of 15.7
million years. It decays (or rather: decayed!) to the noble gas
^129^Xe. Although there is no (natural) ^129^I in the Solar System
today, the nuclide did exist during its earliest stages. Iodine-rich
meteorites that existed within the first few 10s of millions of years
of Solar System history contain measurable amounts of excess of
^129^Xe.

   Consider two meteorites with ^129^Xe/^127^I ratios of
   13$\times{10}^{-5}$ and 8$\times{10}^{-5}$, respectively. What is
   the age _difference_ between the two meteorites? Assume that all
   the ^129^Xe is radiogenic, and that the early Solar System had a
   homogeneous ^129^I/^127^I-composition.

   \ifsol
   Let $[{}^{129}I/{}^{127}I]_\circ$ be the (unknown) ^129^I/^127^I-composition
   of the early Solar System, and let $t_A$ and $t_B$ be the ages of the
   two meteorites (counting from the start of the Solar System). Then
   \[
   \left[\frac{{}^{129}Xe}{{}^{127}I}\right]_A =
   \left[\frac{{}^{129}I}{{}^{127}I}\right]_\circ\exp[-\lambda_{129}t_A]
   \]
   and
   \[
   \left[\frac{{}^{129}Xe}{{}^{127}I}\right]_B =
   \left[\frac{{}^{129}I}{{}^{127}I}\right]_\circ\exp[-\lambda_{129}t_B]
   \]
   The ratio of the two ratios is:
   \[
   \frac{\left[\frac{{}^{129}Xe}{{}^{127}I}\right]_A}
       {\left[\frac{{}^{129}Xe}{{}^{127}I}\right]_B} =
	 \exp[\lambda_{129}(t_B-t_A)]
   \]
   Hence
   \[
   t_B-t_A = \frac{1}{\lambda_{129}}
   \left(
   \ln\left[\frac{{}^{129}Xe}{{}^{127}I}\right]_A -
   \ln\left[\frac{{}^{129}Xe}{{}^{127}I}\right]_B
   \right)
   \]
   \fi
   ```{r}
   l129 <- log(2)/15.7
   XeIA <- 13e-5
   XeIB <- 8e-5
   dt <- (log(XeIA)-log(XeIB))/l129
   message('The age difference between the two meteorites is ',
   signif(dt,3),' million years.')
   ```

```{r include=FALSE}
tsmp <- 200
tstd <- 98
l40 <- log(2)/1248
J <- 0.0025
# 1. standard:
Ar06std_a <- 298.5
Ar09std_r <- (exp(l40*tstd)-1)/J
Ar96std <- 100
Ar06std_m <- Ar09std_r*Ar96std + Ar06std_a
# 2. sample:
Ar06smp_a <- 350
Ar09smp_r <- (exp(l40*tsmp)-1)/J
Ar96smp <- c(10,110,160)
Ar06smp_m <- Ar09smp_r*Ar96smp + Ar06smp_a
tabArAr <- round(rbind(c(Ar96std,Ar06std_m),
                 cbind(Ar96smp,Ar06smp_m)))
colnames(tabArAr) <- c("^39^Ar/^36^Ar","^40^Ar/^36^Ar")
rownames(tabArAr) <- c("std","smp1","smp2","smp3")
```
1. Given the ^40^Ar/^39^Ar-data shown in the following table:

   ```{r include=TRUE, echo=FALSE, results='asis'}
   knitr::kable(tabArAr)
   ```

   'std' is a 98 Ma reference material whose inherited argon content
   is of atmospheric origin ($[$^40^Ar/^36^Ar$]$~atm~=298.5); 'smp1',
   'smp2' and 'smp3' are three cogenetic aliquots of a metamorphic
   sample of unknown age.  What are the age and non-radiogenic
   ^40^Ar/^36^Ar-ratio of the sample? Recall that the half-life of
   ^40^K is 1248 Myr.

   ```{r out.width='50%', fig.width=5, fig.height=4}
   # 1. atmospheric correction of the standard
   Ar40Ar36a <- 298.5
   Ar40Ar36m <- tabArAr['std',2]
   Ar40Ar36r <- Ar40Ar36m - Ar40Ar36a
   # 2. compute the J factor
   tstd <- 98
   l40 <- log(2)/1248
   Ar39Ar36m <- tabArAr['std',1]
   J <- (exp(l40*tstd)-1)*Ar39Ar36m/Ar40Ar36r
   # 3. construct an isochron for the sample:
   Ar39Ar36_smp <- tabArAr[2:4,1]
   Ar40Ar36_smp <- tabArAr[2:4,2]
   plot(x=Ar39Ar36_smp,y=Ar40Ar36_smp,type='b')
   # 4. you can compute the slope and intercept of the line
   #    either manually or using R's lm function:
   fit <- lm(Ar40Ar36_smp ~ Ar39Ar36_smp)
   Ar40Ar36_smp_0 <- fit$coefficients[1]
   Ar40Ar39_smp_r <- fit$coefficients[2]
   # 5. compute the age of the sample
   tsmp <- log(J*Ar40Ar39_smp_r + 1)/l40
   message('age=',signif(tsmp,2),
           'Ma, inherited 40/36-ratio=',signif(Ar40Ar36_smp_0,2))
   ```

1. Analysis of a granite yields:
   ```{r include=FALSE}
   l38 <- IsoplotR::settings('lambda','U238')[1]
   l40 <- IsoplotR::settings('lambda','K40')[1]
   l87 <- IsoplotR::settings('lambda','Rb87')[1]
   tUPbzirc <- 520
   tKAramp <- 480
   tKArbio <- 400
   tRbSrmusc <- 470
   tRbSrbio <- 460
   PbUzirc <- exp(l38*tUPbzirc)-1
   ArKamp <- exp(l40*tKAramp)-1
   ArKbio <- exp(l40*tKArbio)-1
   SrRbmusc <- exp(l87*tRbSrmusc)-1
   SrRbbio <- exp(l87*tRbSrbio)-1
   ttab <- matrix(signif(c(PbUzirc,ArKamp,ArKbio,SrRbmusc,SrRbbio),3),1,5)
   colnames(ttab) <- c("^206^Pb*/^238^U (zircon)","^40^Ar*/^40^K (amphibole)",
                       "^40^Ar*/^40^K (biotite)","^87^Sr*/^87^Rb (muscovite)",
       		       "^87^Sr*/^87^Rb (biotite)")
   ```
   ```{r include=TRUE, echo=FALSE, results='asis'}
   knitr::kable(ttab)
   ```
   What is the likely age of intrusion of this granite? How reliable
   is the result?

   ```{r}
   tt <- log(ttab+1)/c(l38,l40,l40,l87,l87)
   colnames(tt) <- c('U-Pb (zirc)','K-Ar (amp)','K-Ar (bio)',
   	     	     'Rb-Sr (musc)','Rb-Sr (bio)')
   print(tt)
   ```
   \ifsol
   The true age is probably around 550--520 Ma. The reason
   being that some disruptive phenomenon has affected the region as
   there is clearly a discordance in ages. The most robust of the
   chronometers is U-Pb on zircons, but it is not perfect and this
   apparent age may be made a little older. But this reasoning is
   very rough and ready! A more detailed assessment would involve
   textural analysis, diffusion experiments and numerical modelling.
   \fi

1. Age-elevation profiles are a powerful method to determine tectonic
exhumation rates: by measuring the U-Th-He (and/or fission track) ages
of samples collected at different elevations along a steep mountain
transect, it is possible to determine vertical travel times from the
closure isotherm ($\sim{60}^\circ$C) to the Earth's surface.
Consider the following dataset:
```{r include=FALSE}
   dzdt <- 5e-4 # m/yr
   z <- c(2000,3000,3500,4000) # m, sample elevation
   D <- 0 # m, elevation of the closure isotherm
   tHe <- ((z-D)/dzdt)*1e-6
   Uppm <- c(10,12,9,15) # ppm
   Thppm <- c(20,15,12,25) # ppm
   MU <- 238.03
   MTh <- 232.04
   l38 <- IsoplotR::settings('lambda','U238')[1]
   l35 <- IsoplotR::settings('lambda','U235')[1]
   l32 <- IsoplotR::settings('lambda','Th232')[1]
   Unmolg <- 1000*Uppm/MU
   Thnmolg <- 1000*Thppm/MTh
   PU <- 8*(137.818/138.818)*(exp(l38*tHe)-1) + 7*(1/138.818)*(exp(l35*tHe)-1)
   PTh <- 6*(exp(l32*tHe)-1)
   Hepmolg <- (PU*Unmolg + PTh*Thnmolg)*1e3
   UThHetab <- cbind(z,signif(Hepmolg,3),10,
                     Uppm,1,Thppm,1)
   rownames(UThHetab) <- 1:length(z)
   colnames(UThHetab) <- c('elev (m)','He (pmol/g)','s(He)',
                           'U (ppm)','s(U)', 'Th (ppm)','s(Th)')
   tab <- UThHetab
   ```
   ```{r include=TRUE, echo=FALSE, results='asis'}
   knitr::kable(UThHetab)
   ```
   
   (a) Convert these data to internally consistent atomic units.

   (b) Plug them into the online version of `IsoplotR` (
   [`http://isoplotr.es.ucl.ac.uk`](http://isoplotr.es.ucl.ac.uk) ).

   (c) Calculate the U-Th-He ages.

   (d) Determine the exhumation rate.

   ```{r}
   # Suppose that the data are stored in a matrix called tab:
   z <- tab[,1]
   Hepmolg <- tab[,2]
   sHepmolg <- tab[,3]
   Uppm <- tab[,4]
   sUppm <- tab[,5]
   Thppm <- tab[,6]
   sThppm <- tab[,7]
   MU <- 238.03
   MTh <- 232.04
   # convert to micromol/g
   U <- Uppm/MU
   Th <- Thppm/MTh
   He <- Hepmolg/1e6
   sU <- sUppm/MU
   sTh <- sThppm/MTh
   sHe <- sHepmolg/1e6
   IsoplotRtab <- cbind(He,sHe,U,sU,Th,sTh)
   IsoplotRtab
   # plug into IsoplotR
   tHe <- IsoplotR::age(IsoplotR:::as.UThHe(IsoplotRtab))
   tHe
   # plot age-elevation profile:
   plot(tHe[,1],z,type='b')
   # exhumation rate:
   slope <- lm(z ~ tHe[,1])$coefficients[2]
   message('Exhumation rate = ',signif(slope,3), ' m/Myr')
   ```

1. Consider a rapidly cooled (volcanic) apatite of 10 Ma with an
atomic Th/U ratio of 5. What is the ratio of helium atoms to fission
tracks in it?  Look up the relevant decay constants in the notes.

   \ifsol
   The helium ingrowth equation:

   $$
   He =
   \left[
   8 \frac{137.818}{138.818} (e^{\lambda_{238}t}-1) +
   7 \frac{1}{138.818} (e^{\lambda_{235}t}-1)
   \right] U + 6 (e^{\lambda_{232}t}-1) Th
   $$

   Because Th/U=5:
  
   $$
   He =
   \left[
   8 \frac{137.818}{138.818} (e^{\lambda_{238}t}-1) +
   7 \frac{1}{138.818} (e^{\lambda_{235}t}-1) +
   5 \times 6 (e^{\lambda_{232}t}-1)
   \right] U
   $$

   The fundamental fission track age equation:

   $$
   n_s = \frac{\lambda_f}{\lambda_{238}}
   \frac{137.818}{138.818} U (e^{\lambda_{238}t}-1)
   $$

   Hence:

   $$
   \frac{He}{n_s} =
   \frac{
   8 \frac{137.818}{138.818} (e^{\lambda_{238}t}-1) +
   7 \frac{1}{138.818} (e^{\lambda_{235}t}-1) +
   30 (e^{\lambda_{232}t}-1)
   }{
   \frac{\lambda_f}{\lambda_{238}}
   \frac{137.818}{138.818} (e^{\lambda_{238}t}-1)
   }
   $$

   In \texttt{R}:
   \fi
   ```{r}
   lf <- 8.46e-11 # Myr-1
   l238 <- 1.55125e-4 # Myr-1
   l235 <- 9.8485e-4 # Myr-1
   l232 <- 4.95e-5 # Myr-1
   tap <- 10 # Ma
   num <- 8*(137.818/138.818)*(exp(l238*tap)-1) +
         (7/138.818)*exp(l235*tap-1) + 30*(exp(l232*tap)-1)
   den <- (lf/l238)*(137.818/138.818)*(exp(l238*tap)-1)
   HeFT <- num/den
   message('The He/FT-ratio is ',signif(HeFT,2))
   ```
	
   \ifsol
   Even though spontaneous fission of ${}^{238}$U happens `only'
   1.8 million times less frequently than $\alpha$-decay,
   the apatite has produced 55 million times more $\alpha$ particles
   than fission tracks because (1) each ${}^{238}$U atom produces
   not one but eight helium atoms, and (2) not only ${}^{238}$U
   but also ${}^{235}$U and ${}^{232}$Th contribute to the helium
   budget. NB: $\alpha$-recoil damages the crystal lattice of
   apatite and other U-bearing minerals, thereby affecting its
   diffusivity. Thus the closure temperature of apatite can
   vary as a function of time and U (and Th) concentration.
   \fi

1. Recent advances in analytical chemistry allow fission track
geochronologist to replace the trusted external detector method with
an alternative approach, in which the U-content of the sample is
measured directly by Laser Ablation Inductively Coupled Mass
Spectrometry (LA-ICP-MS), the same technique that is also used for
in-situ U-Pb geochronology. Using LA-ICP-MS, it is possible to compute
fission track ages using Equation 7.8 of the notes. Calculate the
fission track age and propagate its uncertainty for the following
apatite data:

   | parameter | value |
   |-----------|-------|
   | fission track track count | 49 |
   | counting area | 5000 \textmu m^2^ |
   | fission track length | 15 \textmu m |
   | U-concentration | 10 ppm |
   | density of apatite | 3.19 g/cm^3^ |
   | molar mass of U | 238.03 g/mol |

   ```{r}
   Ns <- 49        # dimensionless
   A <- 5000       # micron^2
   L <- 15         # micron
   Uppm <- 10      # microgram/gram
   apdens <- 3.19  # g/cc
   MU <- 238.03    # g/mol
   rhos <- Ns/A    # micron^-2
   atmumol <- 6.022e17                    # atoms/micromol (Avogadro's number)
   ccmum3 <- 1e-12                        # cc/micron^3
   Umumolg <- Uppm/MU                     # micromol/g
   Umumolcc <- Umumolg*apdens             # micromol/cc
   Uatmum3 <- Umumolcc*ccmum3*atmumol     # atoms(U)/micron^3
   U238atmum3 <- Uatmum3*137.818/138.818  # atoms(U238)/micron^3
   l38 <- 1.55125e-4 # 238U total decay constant, Myr-1
   lf <- 8.46e-11    # 238U fission decay constant, Myr-1
   R <- l38*rhos/(lf*U238atmum3*L)
   tFT <- log(1+R)/l38
   rhoserr <- sqrt(Ns)/A
   Rerr <- l38*rhoserr/(lf*U238atmum3*L)
   tFTerr <- Rerr/((1+R)*l38)
   message('age=',signif(tFT,3),'Ma, s.e.=',signif(tFTerr,3),'Ma')
   ```
   ```{r include=FALSE}
   tAr <- 50
   tFT <- 50
   tHe <- 50
   J <- 0.005
   zeta <- 300
   rhoD <- 2.5e6
   l40 <- log(2)/1248
   l38 <- 1.55125e-4
   Ar96 <- 100
   Ar06 <- 298.5 + Ar96*(exp(l40*tAr)-1)/J
   Ni <- 100
   Ns <- round(Ni*(exp(l38*tFT)-1)*2/(l38*zeta*rhoD/1e6))
   thermotab <- rbind(format(J,digits=3),Ar96,format(Ar06,digits=0),zeta,rhoD,Ns,Ni)
   rownames(thermotab) <- c('J','^39^Ar/^36^Ar','^40^Ar/^36^Ar',
   'zeta (yr cm^2^)','rho~D~ (cm^-2^)',
   'N~s~','N~i~')
   tab <- rbind(J,Ar96,round(Ar06),zeta,rhoD,Ns,Ni)
   ```
   
1. Consider a rock whose U-Th-He age is `r tHe` Ma. Suppose that the
following data were acquired on the same sample:
   ```{r include=TRUE, echo=FALSE, results='asis'}
   knitr::kable(thermotab)
   ```

   Assuming that the ^36^Ar is of atmospheric origin (with
   ^40^Ar/^36^Ar~atm~=298.5), and using the notes for decay constants etc.,
   summarise the geological history of the sample.
   ```{r}
   # suppose that the data are in a table called tab:
   J <- tab[1]
   Ar96 <- tab[2]
   Ar06 <- tab[3]
   Ar06a <- 298.5
   zeta <- tab[4]
   rhoD <- tab[5]
   Ns <- tab[6]
   Ni <- tab[7]
   tHe <- 50
   Ar09r <- (Ar06-Ar06a)/Ar96 # radiogenic Ar40/Ar39 ratio
   tArAr <- log(1+J*Ar09r)/l40
   g <- 0.5
   tFT <- log(1+g*l38*zeta*1e-6*rhoD*Ns/Ni)/l38
   message('t(Ar-Ar)=',signif(tArAr,3),'=',
           't(FT)=',signif(tFT,3),'=',
	   't(U-Th-He)=',tHe,', suggesting rapid cooling')
   ```

1. Which of the following pairs of grain sizes and cooling rates are
characterised by the same closure temperature?
   ```{r}
   r <- c(50,200,100,400,200,100)
   C <- c(1,2,5,8,4,2)*1e5
   dTdt <- C/(r^2)
   difftab <- rbind(format(r,digits=0),dTdt)
   rownames(difftab) <- c('r (micron)','dT/dt (K/Myr)')
   ```
   ```{r include=TRUE, echo=FALSE, results='asis'}
   knitr::kable(difftab)
   ```
   \ifsol
   According to Dodson's equation, closure temperature
   is a function of $r^2 \times dT/dt$. Plotting this
   product for the given data:
   \fi
   ```{r}
   print(dTdt*r^2)
   ```
   \ifsol
   leads to the conclusion that the first and the sixth samples have
   the same closure temperature.
   \fi

1. The ^234^U/^238^U activity ratio of sea water rarely exceeds
1.15.  However, much higher activity ratios have been measured in
fresh waters and cave carbonates (speleothems). Suppose that we have
measured a ^234^U/^238^U activity ratio of 1.1 in a 1 Ma old
speleothem. What was its _initial_ ^234^U/^238^U-ratio?

   \ifsol
   Rearrange Equation 9.3 of the notes for $\gamma_\circ$:
   $$
   \gamma_\circ = 1 + \left(\frac{A(^{234}U)}{A(^{238}U)} - 1\right) e^{\lambda_{234}t}
   $$
   \fi
   ```{r}
   tU48 <- 1000 # ka
   l234 <- 0.00282206 # kyr-1
   A48 <- 1.1
   g0 <- 1 + (A48-1)*exp(l234*tU48)
   message('The initial 234U/238U activity ratio was ',signif(g0,3))
   ```

1. Although U-series disequilibrium measurements were historically
done by $\alpha$-counting, in recent decades this method has been
replaced by mass spectrometry. Consider the following composition of
three cogenetic aliquots:

   ```{r include=FALSE}
   tThU <- 50
   A02i <- 0.5
   l238 <- 1.55125e-7 # kyr-1
   Uppm <- c(2,4,5)
   Umumolg <- Uppm/238.03
   U238mumolg <- Umumolg*137.818/138.818
   AU238 <- U238mumolg*l238
   l232 <- 4.95e-8 # kyr-1
   l230 <- 0.0091705 # kyr-1
   Thppm <- c(5,3,3)
   Th232mumolg <- Thppm/232.04
   ATh232 <- Th232mumolg*l232
   A02 <- A02i + (AU238/ATh232)*(1-exp(-l230*tThU))
   ATh230 <- ATh232*A02
   Th230mumolg <- ATh230/l230
   Th02 <- Th230mumolg/Th232mumolg
   tabThU <- cbind(Uppm,Thppm,format(Th02,digits=4,scientific=FALSE))
   colnames(tabThU) <- c('ppm U','ppm Th','^230^Th/^232^Th')
   rownames(tabThU) <- 1:length(Uppm)
   ```
   ```{r include=TRUE, echo=FALSE, results='asis'}
   knitr::kable(tabThU)
   ```
   How old is the rock?
   ```{r}
   # store the data into three variables Uppm, Thppm, Th02
   # 1. convert Uppm and Thppm to activities:
   l238 <- 1.55125e-7 # kyr-1
   l232 <- 4.95e-8 # kyr-1
   MU <- 238.03
   MTh <- 232.04
   U238mumolg <- (Uppm/MU)*(137.818/138.818)
   Th232mumolg <- Thppm/MTh
   AU238 <- U238mumolg*l238
   ATh232 <- Th232mumolg*l232
   # (inspect the activities in relatable units):
   Navog <- 6.022e23
   AU238dpmg <- AU238*Navog/(1e3*365*24*60) # dpm per gram
   ATh232dpmg <- ATh232*Navog/(1e3*365*24*60) # dpm per gram
   message('A(U238)=',paste0(signif(AU238dpmg,6),', '),' dpm/g')
   message('A(Th232)=',paste0(signif(ATh232dpmg,6),', '),' dpm/g')
   # 2. compute the activity ratios:
   A82 <- AU238/ATh232
   Th230mumolg <- Th232mumolg*Th02
   l230 <- 0.0091705 # kyr-1
   ATh230 <- Th230mumolg*l230
   ATh230dpmg <- ATh230*Navog/(1e3*365*24*60) # dpm per gram
   message('A(Th230)=',paste0(signif(ATh230dpmg,6),', '),' dpm/g')
   A02 <- ATh230/ATh232
   # 3. plot on an isochron diagram and find the slope:
   plot(x=A82,y=A02,type='b',xlab='U238/Th232',ylab='Th230/Th232')
   slope <- lm(A02 ~ A82)$coefficients[2]
   # verify that this equals diff(A02)/diff(A82)
   # 5. compute the age:
   tThU <- -log(1-slope)/l230
   message('the Th/U-age is ',signif(tThU,3),'ka')
   ```

# Practicals

1. Write a function to simulate radioactive decay, following the
recipe shown in slide 13 of the first theory presentation. Compare the
numerical approximation with the analytical solution. Explore the
effect of different time steps on the accuracy of the simulation.

   ```{r}
   decay <- function(P0=100,lambda=0.1,dt=1){
      t12 <- log(2)/lambda
      tt <- seq(from=0,to=5*t12,by=dt)
      nt <- length(tt)
      P <- rep(P0,nt) # initialise
      for (i in 2:nt){
      dPdt <- -P[i-1]*lambda
      P[i] <- P[i-1] + dPdt*dt
      }
      Pexact <- P0*exp(-lambda*tt)
      plot(tt,P,pch=16,cex=0.5)
      mtext(text=paste0('P0=',P0,', lambda=',lambda,', dt=',dt),
            side=3,line=-1,cex=0.8)
      lines(tt,Pexact)
   }

   # use the function:
   par(mfrow=c(2,2),mar=c(4,4,0.5,0.5))
   decay()
   decay(dt=5)
   decay(dt=0.01)
   decay(P0=1000)
   ```

1. Plot the U-Pb composition of sample 91500 on a Tera-Wasserburg
concordia diagram (^207^Pb/^206^Pb vs. ^238^U/^206^Pb). Use a
^238^U/^235^U-ratio of 137.818 for the conversion from Wetherill to
Tera-Wasserburg space.

   ```{r}
   # Given the results of the main U-Pb practical:
   smp0735a <- 1.873638
   smp0638a <- 0.1819523
   # A. basic solution
   tt <- seq(from=0,to=2000,length.out=50)
   x <- exp(l35*tt)-1
   y <- exp(l38*tt)-1
   if (FALSE){ # basic solution
     plot(x,y,type='l')
     points(smp0735a,smp0638a)
   } else { # fancy solution
     plot(x,y,type='l',
          xlab=expression(''^207*'Pb/'^235*'U'),
   	  ylab=expression(''^206*'Pb/'^238*'U'))
     points(smp0735a,smp0638a,pch=21,bg='white')
   }
   # add age ticks to the concordia plot:
   ttick <- seq(from=0,to=2000,by=250)
   xt <- exp(l35*ttick)-1
   yt <- exp(l38*ttick)-1
   points(xt,yt,pch=16)
   text(xt,yt,labels=ttick,pos=2)
   ```
   ```{r}
     # Compute the Pb207/Pb206-ratio from the conventional ratios:
     U3835 <- 137.818
     smp0706a <- smp0735a/(U3835*smp0638a)
     # draw the concordia line
     l38 <- 0.000155125
     l35 <- 0.00098485
     tt <- seq(from=100,to=2000,length.out=50)
     x <- 1/(exp(l38*tt)-1)
     y <- (exp(l35*tt)-1)/(U3835*(exp(l38*tt)-1))
     plot(x,y,type='l',
          xlab=expression(''^238*'U/'^238*'Pb'),
          ylab=expression(''^207*'Pb/'^206*'Pb'))
     # add the sample data:
     points(x=1/smp0638a,y=smp0706a,pch=21,bg='white')
     # add age ticks to the concordia plot:
     ttick <- seq(from=0,to=2000,by=250)
     xt <- 1/(exp(l38*ttick)-1)
     yt <- (exp(l35*ttick)-1)/(U3835*(exp(l38*ttick)-1))
     points(xt,yt,pch=16)
     text(xt,yt,labels=ttick,pos=4)
   ```

```{r include=FALSE}
dir <- '/home/pvermees/Documents/geotopes/practicals/extra/'
setwd(dir)

# generate synthetic Ar/Ar dataset
J <- 0.003
l40 <- 5.543e-4
a4036 <- 295.5
t <- 30:180 # acquisition times

createfile <- function(t36_0,t39_0,t40_0,t,fname){
   nt <- length(t)
   r36 <- rpois(n=nt,lambda=t36_0-(t36_0/1000)*t)
   r39 <- rpois(n=nt,lambda=t39_0-(t39_0/1000)*t)
   r40 <- rpois(n=nt,lambda=t40_0-(t40_0/1000)*t)
   tab <- cbind(t,r36,r39,r40)
   colnames(tab) <- c('t','Ar36','Ar39','Ar40')
   write.csv(tab,file=fname,row.names=FALSE)
}

ts <- 27.8
s36_0 <- 5
s40a <- a4036*s36_0
s40t <- 400000
s40_0 <- s40t + s40a
s4039t <- (exp(l40*ts)-1)/J
s39_0 <- s40t/s4039t
createfile(s36_0,s39_0,s40_0,t,'stnd.csv')

b36_0 <- 1
b40_0 <- b36_0*a4036
b39_0 <- 1
createfile(b36_0,b39_0,b40_0,t,'blnk.csv')

tx <- c(45,65,80,90,95,97.5,99,101,99,100)
x36_0 <- 10
x40a <- a4036*x36_0
x40t <- c(0.02,0.05,0.1,0.4,0.5,0.5,0.6,0.4,0.2,0.05)*700000
x40_0 <- x40t + x40a
x4039t <- (exp(l40*tx)-1)/J
x39_0 <- x40t/x4039t

for (i in 1:length(tx)){
   fname <- paste0('smpl',i,'.csv')
   createfile(x36_0,x39_0[i],x40_0[i],t,fname)
}
```

1. Process files `smpl1.csv` through `smpl10.csv` using your Ar-Ar
data reduction script. Plot the results as an Ar-Ar release spectrum,
using the following function. `Ar39` and `tx` are both vectors
containing the blank corrected ^39^Ar signals and ^40^Ar/^39^Ar age
estimates, respectively:

   ```{r include=TRUE}
   spectrum <- function(Ar39,tx){
      Ar39n <- cumsum(c(0,Ar39))/sum(Ar39) # normalise
      plot(x=Ar39n, y=c(tx[1],tx), type='s',
           xlab=expression(''^39*"Ar (%)"), ylab='Ar-Ar age (Ma)')
   }
   ```

   ```{r}
   process <- function(std,smp,blk){
      # linear regression of the data
      std36fit <- lm(Ar36 ~ t, data=std)
      std39fit <- lm(Ar39 ~ t, data=std)
      std40fit <- lm(Ar40 ~ t, data=std)
      smp36fit <- lm(Ar36 ~ t, data=smp)
      smp39fit <- lm(Ar39 ~ t, data=smp)
      smp40fit <- lm(Ar40 ~ t, data=smp)
      blk36fit <- lm(Ar36 ~ t, data=blk)
      blk39fit <- lm(Ar39 ~ t, data=blk)
      blk40fit <- lm(Ar40 ~ t, data=blk)
      # blank correction
      std36b <- std36fit$coefficients[1] - blk36fit$coefficients[1]
      std39b <- std39fit$coefficients[1] - blk39fit$coefficients[1]
      std40b <- std40fit$coefficients[1] - blk40fit$coefficients[1]
      smp36b <- smp36fit$coefficients[1] - blk36fit$coefficients[1]
      smp39b <- smp39fit$coefficients[1] - blk39fit$coefficients[1]
      smp40b <- smp40fit$coefficients[1] - blk40fit$coefficients[1]
      # atmospheric correction
      a4036 <- 298.5
      std40r <- std40b - std36b*a4036
      smp40r <- smp40b - smp36b*a4036
      # calculate J
      tstd <- 27.8    # standard age, in Ma
      l40 <- 5.543e-4 # decay constant, in Ma-1
      J <- (exp(l40*tstd)-1)*(std39b/std40r)
      # calculate age
      tx = log(1 + J*smp40r/smp39b)/l40
      out <- list(Ar39=smp39b,tx=tx)
      return(out)
   }

   setwd(dir)
   std <- read.csv("stnd.csv",header=TRUE)
   blk <- read.csv("blnk.csv",header=TRUE)
   ns <- 10 # number of samples
   Ar39 <- rep(NA,ns)
   tx <- rep(NA,ns)
   for (i in 1:ns){
      sname <- paste0('smpl',i,'.csv')
      smp <- read.csv(sname,header=TRUE)
      results <- process(std,smp,blk)
      Ar39[i] <- results$Ar39
      tx[i] <- results$tx
   }

   spectrum(Ar39,tx)
   ```